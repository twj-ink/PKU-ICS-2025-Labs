# PKU 2025 Bomblab Secret_phaseè§£æ--FSMè‡ªåŠ¨æœºå’ŒåŒæ­¥æ£€æµ‹

æœ¬äººåˆšæ‹¿åˆ°labå› ä¸ºæ“ä½œä¸å½“ï¼ˆè„‘æ®‹ï¼‰æ²¡è®¾ç½®æ–­ç‚¹ç›´æ¥çˆ†äº†ä¸€æ¬¡ï¼Œå¤§å®¶åŠ¡å¿…ä¸è¦å­¦æˆ‘ï¼Œä¸€å®šè¦åœ¨gdbè¿è¡Œä¹‹å‰ç»™explode_bombè®¾ç½®æ–­ç‚¹ï¼Œæˆ–è€…å‚è€ƒhttps://arthals.ink/ è¿™ä½å­¦é•¿çš„åšå®¢å®‰å…¨åŒ–

è¿™æ˜¯åœ¨å®Œæˆå…­ä¸ªé˜¶æ®µä¹‹åçš„éšè—é˜¶æ®µï¼Œä¸ªäººè§‰å¾—å¾ˆå·§å¦™ã€‚ä»Šå¹´çš„éšè—é˜¶æ®µä¸æ˜¯åŸç‰ˆçš„äºŒå‰æ ‘è·¯å¾„æ±‚å’Œï¼Œè€Œæ˜¯FSMè‡ªåŠ¨çŠ¶æ€æœºï¼Œéœ€è¦è‡ªè¡Œæ‰¾åˆ°çŠ¶æ€è½¬ç§»å¯¹åº”çš„è¡¨ã€‚æœ¬æ–‡ä»…ç»™å‡ºéšè—é˜¶æ®µçš„è¿›å…¥æ–¹å¼å’Œç ´è§£æ–¹æ³•ã€‚

æ­¤å¤–ï¼Œè¿›å…¥éšè—é˜¶æ®µéœ€è¦çœ‹æ‡‚ä¸¤ä¸ªé­”æ³•å‡½æ•°ï¼Œä¸è¿‡ä¸ºäº†å¾—åˆ†å¯ä»¥ç›´æ¥å¼ºè¡Œç”¨gbdè·³åˆ°éšè—é˜¶æ®µçš„å‡½æ•°ä¸­ï¼Œé¿å¼€æ­£é¢è¿›å…¥å‡½æ•°çš„è¿‡ç¨‹ã€‚

### è¿›å…¥æ–¹å¼

åœ¨mainå‡½æ•°ä¸­ï¼Œåœ¨å®Œæˆå…­ä¸ªé˜¶æ®µã€æ‰§è¡Œ`phase_defused`ä¹‹åï¼Œå°±ç»“æŸç¨‹åºäº†ã€‚è¿›ä¸€æ­¥æŸ¥çœ‹`phase_defused`çš„æ±‡ç¼–ä»£ç ï¼Œå‘ç°é‡Œé¢æ˜¯å­˜åœ¨`call   1c01 <secret_phase>`çš„å‡½æ•°è°ƒç”¨çš„ï¼ˆåœ¨2305å¤„ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæƒ³è¿›å…¥éšè—é˜¶æ®µéœ€è¦åœ¨è¿™ä¸ªå‡½æ•°ä¸­æ»¡è¶³æŸäº›æ¡ä»¶ã€‚ä¸‹é¢æ˜¯`phase_defused`çš„æ±‡ç¼–ä»£ç ï¼Œæˆ‘ä¼šå¯¹å…¶è¿›è¡Œé€æ®µåœ°åˆ†æï¼ˆåˆ†æåœ¨æ±‡ç¼–ä¸‹æ–¹ï¼‰ï¼Œå…¶ä¸­æœ‰å››å¤„è¿›å…¥éšè—é˜¶æ®µä¹‹å‰çš„åˆ¤å®šï¼šï¼ˆæ³¨æ„ï¼šä»¥ä¸‹gdbçš„è¾“å‡ºå‡æ˜¯åœ¨phase6ä¸­æˆ–å®Œæˆphase6å‡½æ•°åçš„è¾“å‡ºï¼‰

```assembly
0000000000002265 <phase_defused>:
    2265:	f3 0f 1e fa          	endbr64
    2269:	53                   	push   %rbx

    # PART 1
    226a:	48 89 fb             	mov    %rdi,%rbx
    226d:	c7 07 00 00 00 00    	movl   $0x0,(%rdi)
    2273:	48 89 fe             	mov    %rdi,%rsi
    2276:	bf 01 00 00 00       	mov    $0x1,%edi
    227b:	e8 7a fc ff ff       	call   1efa <send_msg>
    2280:	83 3b 01             	cmpl   $0x1,(%rbx)              ## åˆ¤å®š(1)
    2283:	75 0b                	jne    2290 <phase_defused+0x2b>

    2285:	83 3d 8c 62 00 00 06 	cmpl   $0x6,0x628c(%rip)  ## åˆ¤å®š(2)      # 8518 <num_input_strings>
    228c:	74 22                	je     22b0 <phase_defused+0x4b>
    228e:	5b                   	pop    %rbx
    228f:	c3                   	ret

    2290:	48 8d 35 39 21 00 00 	lea    0x2139(%rip),%rsi        # 43d0 <transition_table+0xd0>
    2297:	bf 01 00 00 00       	mov    $0x1,%edi
    229c:	b8 00 00 00 00       	mov    $0x0,%eax
    22a1:	e8 ba f0 ff ff       	call   1360 <__printf_chk@plt>
    22a6:	bf 08 00 00 00       	mov    $0x8,%edi
    22ab:	e8 e0 f0 ff ff       	call   1390 <exit@plt>

    22b0:	e8 af f3 ff ff       	call   1664 <abracadabra>
    22b5:	85 c0                	test   %eax,%eax
    22b7:	75 1a                	jne    22d3 <phase_defused+0x6e>  ## åˆ¤å®š(3)

    22b9:	48 8d 3d 70 22 00 00 	lea    0x2270(%rip),%rdi        # 4530 <transition_table+0x230>
    22c0:	e8 ab ef ff ff       	call   1270 <puts@plt>
    22c5:	48 8d 3d ac 22 00 00 	lea    0x22ac(%rip),%rdi        # 4578 <transition_table+0x278>
    22cc:	e8 9f ef ff ff       	call   1270 <puts@plt>
    22d1:	eb bb                	jmp    228e <phase_defused+0x29>

    22d3:	e8 19 f4 ff ff       	call   16f1 <alohomora>
    22d8:	85 c0                	test   %eax,%eax
    22da:	74 30                	je     230c <phase_defused+0xa7>  ## åˆ¤å®š(4)

    22dc:	48 8d 3d 5d 21 00 00 	lea    0x215d(%rip),%rdi        # 4440 <transition_table+0x140>
    22e3:	e8 88 ef ff ff       	call   1270 <puts@plt>
    22e8:	48 8d 3d 79 21 00 00 	lea    0x2179(%rip),%rdi        # 4468 <transition_table+0x168>
    22ef:	e8 7c ef ff ff       	call   1270 <puts@plt>
    22f4:	48 8d 3d a5 21 00 00 	lea    0x21a5(%rip),%rdi        # 44a0 <transition_table+0x1a0>
    22fb:	e8 70 ef ff ff       	call   1270 <puts@plt>
    2300:	b8 00 00 00 00       	mov    $0x0,%eax
    2305:	e8 f7 f8 ff ff       	call   1c01 <secret_phase>

    230a:	eb ad                	jmp    22b9 <phase_defused+0x54>
    230c:	48 8d 3d dd 21 00 00 	lea    0x21dd(%rip),%rdi        # 44f0 <transition_table+0x1f0>
    2313:	e8 58 ef ff ff       	call   1270 <puts@plt>
    2318:	48 8d 3d 81 21 00 00 	lea    0x2181(%rip),%rdi        # 44a0 <transition_table+0x1a0>
    231f:	e8 4c ef ff ff       	call   1270 <puts@plt>
    2324:	eb 93                	jmp    22b9 <phase_defused+0x54>
```

#### åˆ¤å®š(1)

é¦–å…ˆç¬¬ä¸€æ®µä¸­ï¼š
```
    226a:	48 89 fb             	mov    %rdi,%rbx   
    226d:	c7 07 00 00 00 00    	movl   $0x0,(%rdi)
    2273:	48 89 fe             	mov    %rdi,%rsi
    2276:	bf 01 00 00 00       	mov    $0x1,%edi
    227b:	e8 7a fc ff ff       	call   1efa <send_msg>
    2280:	83 3b 01             	cmpl   $0x1,(%rbx)
    2283:	75 0b                	jne    2290 <phase_defused+0x2b>
```
å°†rdiçš„å€¼å­˜ç»™rbxï¼Œè¿™æ—¶äºŒè€…ä¿å­˜çš„åœ°å€æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªåœ°å€æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå†…å­˜ã€‚æ¥ç€å°†rdiåœ°å€æ‰€æŒ‡å‘çš„å†…å­˜çš„å€¼è®¾ç½®ä¸º0x0ï¼Œä¹Ÿå°±æ˜¯æŠŠrbxåœ°å€æ‰€æŒ‡å‘çš„å†…å­˜çš„å€¼è®¾ç½®ä¸ºäº†0x0ã€‚ä¹‹åæŠŠrdièµ‹å€¼ç»™rsiã€æŠŠrdiçš„å€¼è®¾ç½®ä¸º1ï¼Œè¿™äº›éƒ½ä¸é‡è¦ã€‚ç„¶åè°ƒç”¨send_msgå‡½æ•°ã€‚æ¥ç€è¿›è¡Œäº†ç¬¬ä¸€æ¬¡åˆ¤å®šï¼š**rbxåœ°å€æ‰€æŒ‡å‘çš„å†…å­˜çš„å€¼ ä¸ 0x1 çš„åˆ¤æ–­**ã€‚

æˆ‘ä»¬å‘ç°ï¼Œåœ¨226dé‚£ä¸€è¡Œï¼Œä»£ç å·²ç»æ˜ç¡®å°†(%rdi)çš„å€¼è®¾ç½®ä¸ºäº†0ï¼Œè€Œ%rbxå’Œ%rdiæ‰€ä¿å­˜çš„åœ°å€æ˜¯ä¸€æ ·çš„ï¼Œåˆ™(%rbx)åœ¨2280é‚£ä¸€è¡Œåˆ¤æ–­çš„æ—¶å€™å¿…ç„¶æ˜¯0è€Œä¸æ˜¯1ï¼Œä¹Ÿå°±æ˜¯è¯´æ­£å¸¸çš„é€»è¾‘æ¥çœ‹ï¼Œè¿™é‡Œå¿…ç„¶ä¼šæ¥ç€2283é‚£ä¸€è¡Œçš„è·³è½¬ï¼Œè·³è½¬åˆ°2290å¼€å§‹ç»§ç»­è¿è¡Œã€‚ç„¶åå°†åœ¨22abé‚£ä¸€è¡Œå®Œæˆexitå‡½æ•°çš„é€€å‡ºã€‚è¿™æ ·å°†ä¼šä¸2305è¡Œçš„éšè—å‡½æ•°è°ƒç”¨å¤±ä¹‹äº¤è‡‚ã€‚

è¿™é‡Œçš„è§£å†³åŠæ³•æ˜¯ï¼šç›´æ¥è·³è¿‡2276é‚£ä¸€è¡Œçš„èµ‹å€¼ã€‚åœ¨gdbä¸­æŸ¥çœ‹è¯¥è¡Œçš„åœ°å€ï¼Œå¹¶åœ¨phase6å®Œæˆåï¼Œè·³è½¬åˆ°mainå‡½æ•°ä¸­å¹¶ä¸”å³å°†è¿›å…¥phase_defusedå‡½æ•°ä¹‹å‰ï¼Œåœ¨gdbä¸­è¾“å…¥:

```gdb
(gdb) jump *0x55555555626d
```

å³å¯è·³è¿‡è¯¥å¤„çš„åˆ¤å®šã€‚ï¼ˆè¿™é‡Œå‘ç°åªèƒ½é€‰æ‹©è·³è¿‡è¿™ä¸€ä¸ªè¯­å¥ï¼Œè·³è¿‡å…¶ä»–æŒ‡ä»¤å¥½åƒæ— æ³•æ­£å¸¸ç»§ç»­è¿è¡Œï¼‰

#### åˆ¤å®š(2)

æ¥ç€æˆ‘ä»¬æ²¡æœ‰è¿›å…¥2290è€Œæ˜¯ç»§ç»­è¿›è¡Œ2285ï¼Œè¿™é‡Œæœ‰åˆ¤å®š(2):**0x628c(%rip) å’Œ 0x6 çš„ç›¸ç­‰å…³ç³»**ï¼Œå¦‚æœç›¸ç­‰å°±è·³è½¬åˆ°22b0ï¼Œè¿›å…¥åç»­çš„åˆ¤å®šä¸­ï¼›å¦‚æœä¸ç›¸ç­‰å°±ç›´æ¥returnäº†ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹`0x628c(%rip)`å¤„çš„å€¼æ˜¯å¤šå°‘ï¼Œç”±äºç›´æ¥ä½¿ç”¨`x $rip+0x628c`æ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹è¿™é‡Œæ³¨é‡Šä¸­ç»™å‡ºçš„`num_input_strings`çš„åœ°å€ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š

```gdb
(gdb) info address num_input_strings
Symbol "num_input_strings" is at 0x55555555c518 in a file compiled without debugging.

(gdb)p/d *0x55555555c518
$1 = 6
```

æ³¨æ„ï¼Œè¿™é‡Œæ˜¯åœ¨phase6ä¸­æ‰§è¡Œçš„ï¼Œæ‰“å°ç»“æœæ˜¯6ï¼›å¦‚æœåœ¨ä¹‹å‰çš„æ¯”å¦‚phase1ä¸­æ‰“å°ï¼Œå€¼ä¼šæ˜¯1ã€‚ç»“åˆ`num_input_strings`è¿™ä¸ªåç§°ä¹Ÿå¯ä»¥çŒœå‡ºï¼Œè¿™é‡Œæ˜¯æƒ³åˆ¤æ–­ç›®å‰åˆ°è¾¾äº†ç¬¬å‡ ä¸ªé˜¶æ®µï¼Œå¦‚æœæ­¤æ—¶åˆ°è¾¾çš„é˜¶æ®µæ•°æ˜¯6ï¼Œå°±å¯ä»¥åˆ¤å®šæˆåŠŸï¼›å¦åˆ™ä¸è¡Œã€‚æ‰€ä»¥æ­¤å¤„åˆ¤å®šåªéœ€è¦å®Œæˆå…­ä¸ªé˜¶æ®µçš„é¢˜ç›®å³å¯ã€‚

#### åˆ¤å®š(3)

åœ¨ä¸Šè¿°è·³è½¬ä¸‹ï¼Œæˆ‘ä»¬æ¥åˆ°22b0ï¼Œè°ƒç”¨äº†ç¬¬ä¸€ä¸ªé­”æ³•å‡½æ•°ï¼š`abracadabra`ã€‚å…¶è¿”å›å€¼eaxçš„åˆ¤å®šä¸­ï¼Œ**å¦‚æœeaxçš„å€¼ä¸æ˜¯0**ï¼Œå°±ç»§ç»­è·³è½¬åˆ°ç¬¬äºŒä¸ªé­”æ³•å‡½æ•°å¤„ï¼›å¦åˆ™å°±è·³å›åˆšæ‰returnçš„åœ°æ–¹ã€‚æˆ‘ä»¬æŸ¥çœ‹æºç ï¼š

```assembly
0000000000001664 <abracadabra>:
    1664:	f3 0f 1e fa          	endbr64
    1668:	48 81 ec 98 00 00 00 	sub    $0x98,%rsp
    166f:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax
    1676:	00 00 
    1678:	48 89 84 24 88 00 00 	mov    %rax,0x88(%rsp)
    167f:	00 
    1680:	31 c0                	xor    %eax,%eax

    1682:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx  
    1687:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx
    168c:	4c 8d 44 24 10       	lea    0x10(%rsp),%r8
    1691:	48 8d 35 c3 2a 00 00 	lea    0x2ac3(%rip),%rsi        # 415b <_IO_stdin_used+0x15b> 8000
    1698:	48 8d 3d e9 6f 00 00 	lea    0x6fe9(%rip),%rdi        # 8688 <input_strings+0x168> c520
    169f:	e8 9c fc ff ff       	call   1340 <__isoc99_sscanf@plt>
    16a4:	83 f8 03             	cmp    $0x3,%eax
    16a7:	74 20                	je     16c9 <abracadabra+0x65>

    16a9:	b8 00 00 00 00       	mov    $0x0,%eax
    16ae:	48 8b 94 24 88 00 00 	mov    0x88(%rsp),%rdx
    16b5:	00 
    16b6:	64 48 2b 14 25 28 00 	sub    %fs:0x28,%rdx
    16bd:	00 00 
    16bf:	75 2b                	jne    16ec <abracadabra+0x88>
    16c1:	48 81 c4 98 00 00 00 	add    $0x98,%rsp
    16c8:	c3                   	ret

    16c9:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi
    16ce:	48 8d 35 9b 2a 00 00 	lea    0x2a9b(%rip),%rsi        # 4170 <_IO_stdin_used+0x170>
    16d5:	e8 6d 06 00 00       	call   1d47 <strings_not_equal>
    16da:	85 c0                	test   %eax,%eax
    16dc:	74 07                	je     16e5 <abracadabra+0x81>

    16de:	b8 00 00 00 00       	mov    $0x0,%eax
    16e3:	eb c9                	jmp    16ae <abracadabra+0x4a>
    16e5:	b8 01 00 00 00       	mov    $0x1,%eax
    16ea:	eb c2                	jmp    16ae <abracadabra+0x4a>
    16ec:	e8 af fb ff ff       	call   12a0 <__stack_chk_fail@plt>
```

è¿™ä¸ªå‡½æ•°æœ‰ä¸¤å¤„é‡ç‚¹ï¼š
1. åœ¨1682-16a7ä¹‹é—´ï¼Œè°ƒç”¨äº†sscanfå‡½æ•°è·å–è¾“å…¥ï¼Œrdiæ˜¯è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œrsiæ˜¯è·å–è¾“å…¥çš„æ ¼å¼ï¼Œå°†ç»“æœä¿å­˜åœ¨rdxã€rcxã€r8è¿™ä¸‰ä¸ªå¯„å­˜å™¨ä¸­ï¼›åœ¨16a4ä¸­ä¹Ÿå¯¹è¾“å…¥çš„å‚æ•°ä¸ªæ•°è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœæ°å¥½æ˜¯3ä¸ªæ‰è¡Œã€‚æˆ‘ä»¬è¿™é‡Œå¯¹rdiå’Œrsiçš„å­—ç¬¦ä¸²è¿›è¡ŒæŸ¥çœ‹ï¼š

![1](./imgs/image01.png)

æˆ‘ä»¬å‘ç°è¦è¯»å…¥çš„ä¿©æ•´æ•°å’Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸”å‘ç°è¿™ä¿©æ•´æ•°æ°å¥½å°±æ˜¯æˆ‘ä»¬åœ¨phase4ä¸­è¾“å…¥çš„ä¿©æ•°å­—ã€‚è¿™æš—ç¤ºæˆ‘ä»¬ä¼¼ä¹è¦åœ¨phase4çš„é‚£ä¸€è¡Œç­”æ¡ˆä¸­å¤šè¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿åœ¨æ­¤å¤„è¯»å–åŒæ—¶ä¹Ÿä¸ä¼šå½±å“phase4çš„è¿è¡Œï¼ˆå› ä¸ºphase4è¯»å–çš„æ˜¯"%d %d"ï¼‰ã€‚

2. æ¥ç€è·³è½¬åˆ°16c9ï¼Œè¿™é‡Œå°†åˆšåˆšè¯»å–çš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„å­—ç¬¦ä¸²ï¼ˆä¿å­˜åœ¨r8ä¸­ï¼Œä¹Ÿå°±æ˜¯rsp+0x10çš„ä½ç½®ï¼‰åœ°å€å­˜å…¥rdiä¸­ï¼Œå°†ä»æŸä½ç½®è¯»å–çš„ç›®æ ‡å­—ç¬¦ä¸²å­˜åˆ°rsiä¸­ï¼Œç„¶åè°ƒç”¨`strings_not_equal`å‡½æ•°å¾—åˆ°eaxï¼Œåªæœ‰ç›¸ç­‰æ—¶è¿”å›å€¼æ˜¯1ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œè€Œä¸ä¸­æ–­ç¨‹åºã€‚é‚£æˆ‘ä»¬ç»§ç»­æŸ¥çœ‹rsiåˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼š

![2](./imgs/image02.png)

å¥½çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†åŒ¹é…çš„ç›®æ ‡å­—ç¬¦ä¸²æ˜¯ï¼š`...VeniVidiViciTwoThousandYearsAgo?`ã€‚æˆ‘ä»¬**æŠŠå®ƒåŠ åˆ°phase4çš„é‚£ä¸€è¡Œæœ«å°¾ä¸­ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°**ã€‚

#### åˆ¤å®š(4)

æˆ‘ä»¬æ¥åˆ°22d3è¿™ç¬¬äºŒä¸ªé­”æ³•å‡½æ•°ï¼š`alohomora`ï¼ŒåŒæ ·ï¼Œåˆ¤å®šæ¡ä»¶ä¹Ÿæ˜¯è¿”å›å€¼ä¸èƒ½ä¸º0ã€‚æŸ¥çœ‹å…¶æ±‡ç¼–ï¼š

```assembly
00000000000016f1 <alohomora>:
    16f1:	f3 0f 1e fa          	endbr64
    16f5:	48 81 ec 88 00 00 00 	sub    $0x88,%rsp
    16fc:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax
    1703:	00 00 
    1705:	48 89 44 24 78       	mov    %rax,0x78(%rsp)
    170a:	31 c0                	xor    %eax,%eax

    170c:	48 8d 05 85 6e 00 00 	lea    0x6e85(%rip),%rax        # 8598 <input_strings+0x78>
    1713:	eb 04                	jmp    1719 <alohomora+0x28>
    1715:	48 83 c0 01          	add    $0x1,%rax

    1719:	80 38 00             	cmpb   $0x0,(%rax)    
    171c:	75 f7                	jne    1715 <alohomora+0x24>
    171e:	48 83 e8 01          	sub    $0x1,%rax 

    1722:	48 89 e2             	mov    %rsp,%rdx
    1725:	eb 0a                	jmp    1731 <alohomora+0x40>

    1727:	88 0a                	mov    %cl,(%rdx)
    1729:	48 83 c2 01          	add    $0x1,%rdx
    172d:	48 83 e8 01          	sub    $0x1,%rax

    1731:	0f b6 08             	movzbl (%rax),%ecx 
    1734:	80 f9 20             	cmp    $0x20,%cl
    1737:	74 0c                	je     1745 <alohomora+0x54>
    1739:	48 8d 35 58 6e 00 00 	lea    0x6e58(%rip),%rsi        # 8598 <input_strings+0x78>
    1740:	48 39 f0             	cmp    %rsi,%rax
    1743:	75 e2                	jne    1727 <alohomora+0x36>

    1745:	c6 02 00             	movb   $0x0,(%rdx)
    1748:	48 89 e7             	mov    %rsp,%rdi
    174b:	48 8d 35 46 2a 00 00 	lea    0x2a46(%rip),%rsi        # 4198 <_IO_stdin_used+0x198>
    1752:	e8 f0 05 00 00       	call   1d47 <strings_not_equal>
    1757:	85 c0                	test   %eax,%eax
    1759:	74 1d                	je     1778 <alohomora+0x87>
    175b:	b8 00 00 00 00       	mov    $0x0,%eax
    1760:	48 8b 54 24 78       	mov    0x78(%rsp),%rdx
    1765:	64 48 2b 14 25 28 00 	sub    %fs:0x28,%rdx
    176c:	00 00 
    176e:	75 0f                	jne    177f <alohomora+0x8e>
    1770:	48 81 c4 88 00 00 00 	add    $0x88,%rsp
    1777:	c3                   	ret
    1778:	b8 01 00 00 00       	mov    $0x1,%eax
    177d:	eb e1                	jmp    1760 <alohomora+0x6f>
    177f:	e8 1c fb ff ff       	call   12a0 <__stack_chk_fail@plt>
```

é¦–å…ˆåœ¨170cè¡Œè¯»å–äº†8598å¤„çš„å­—ç¬¦ä¸²åˆ°raxä¸­ã€‚æˆ‘ä»¬æŸ¥çœ‹æ­¤å¤„çš„å­—ç¬¦æ˜¯ä»€ä¹ˆï¼š

![3](./imgs/image03.png)

è¿™é‡Œæ°å¥½æ˜¯phase2çš„å…­ä¸ªæ•°å­—ï¼Œå¯èƒ½å’Œä¸Šä¸€ä¸ªå‡½æ•°ç±»ä¼¼ï¼Œæš—ç¤ºæˆ‘ä»¬è¦åœ¨è¿™ä¸ªé˜¶æ®µçš„ç­”æ¡ˆä¸­å¢åŠ æŸäº›ä¸œè¥¿ã€‚è¿™é‡Œæ˜¯raxæ˜¯æˆ‘ä»¬phase2è¿™ä¸€è¡Œå­—ç¬¦ä¸²çš„å¤´å­—ç¬¦çš„ä½ç½®ã€‚

----

* **æ‰¾åˆ°å­—ç¬¦ä¸²ç»“å°¾** 170c-171e

```
170c:	48 8d 05 85 6e 00 00 	lea    0x6e85(%rip),%rax        # 8598 <input_strings+0x78>
1713:	eb 04                	jmp    1719 <alohomora+0x28>
1715:	48 83 c0 01          	add    $0x1,%rax

1719:	80 38 00             	cmpb   $0x0,(%rax)    
171c:	75 f7                	jne    1715 <alohomora+0x24>
171e:	48 83 e8 01          	sub    $0x1,%rax 
```

è·å¾—eaxï¼Œè·³è½¬åˆ°1719å¼€å§‹ç¬¬ä¸€ä¸ªå¾ªç¯ï¼šä¸æ–­æ¯”è¾ƒ**raxå­—ç¬¦æ˜¯å¦æ˜¯$0x0**ï¼ˆ0x0æ˜¯å­—ç¬¦ä¸²ç»“å°¾çš„\0ï¼‰ï¼Œå¦‚æœä¸æ˜¯å°±å°†rax+1ï¼Œæ¯”è¾ƒä¸‹ä¸€ä¸ªå­—ç¬¦ï¼›å¦‚æœæ˜¯ï¼Œè¯´æ˜åˆ°è¾¾äº†å­—ç¬¦ä¸²çš„æœ«å°¾éƒ¨åˆ†ã€‚é‚£ä¹ˆå°±å°†eaxå‡1ï¼Œæ°å¥½åˆ°è¾¾å­—ç¬¦ä¸²çš„æœ«å°¾å­—ç¬¦ã€‚

----

* **åå‘å¤åˆ¶å¾ªç¯** 1722-1743

```
1722: mov    %rsp,%rdx          ; rdxæŒ‡å‘æ ˆç¼“å†²åŒºï¼ˆç›®æ ‡ï¼‰
1725: jmp    1731

1727: mov    %cl,(%rdx)         ; å­˜å‚¨å­—ç¬¦åˆ°æ ˆç¼“å†²åŒº
1729: add    $0x1,%rdx          ; ç›®æ ‡æŒ‡é’ˆå‰è¿›
172d: sub    $0x1,%rax          ; æºæŒ‡é’ˆåé€€ï¼ˆå…³é”®ï¼šåå‘ç§»åŠ¨ï¼‰

; å¾ªç¯å¼€å§‹
1731: movzbl (%rax),%ecx        ; è¯»å–å½“å‰å­—ç¬¦åˆ°cl
1734: cmp    $0x20,%cl          ; æ£€æŸ¥æ˜¯å¦ä¸ºç©ºæ ¼å­—ç¬¦
1737: je     1745               ; å¦‚æœæ˜¯ç©ºæ ¼ï¼Œç»“æŸå¤åˆ¶

1739: lea    0x6e58(%rip),%rsi  ; rsi = å­—ç¬¦ä¸²èµ·å§‹åœ°å€(input_strings+0x78)
1740: cmp    %rsi,%rax          ; æ£€æŸ¥æ˜¯å¦å›åˆ°å­—ç¬¦ä¸²å¼€å¤´
1743: jne    1727               ; å¦‚æœæ²¡åˆ°å¼€å¤´ï¼Œç»§ç»­å¤åˆ¶
1745: movb   $0x0,(%rdx)        ; åœ¨å¤åˆ¶ç»“æœåæ·»åŠ NULL
1748: mov    %rsp,%rdi          ; rdi = åè½¬åçš„å­—ç¬¦ä¸²
```
é¦–å…ˆrdxæŒ‡å‘æ ˆç¼“å†²åŒºã€‚åœ¨è·³åˆ°1731æ—¶ï¼Œå°†raxä¹Ÿå°±æ˜¯æ­¤æ—¶æœ€åçš„å­—ç¬¦å¤åˆ¶åˆ°ecxï¼Œåˆ¤æ–­**clä¸$0x20æ˜¯å¦ç›¸ç­‰**ï¼ˆ0x20æ˜¯ç©ºæ ¼ï¼‰ï¼Œå¦‚æœç›¸ç­‰å°±è·³å‡ºå¾ªç¯ï¼Œä¸æ˜¯å°±ç»§ç»­åˆ¤æ–­**æ­¤æ—¶çš„raxæ˜¯å¦å›åˆ°äº†phase2å­—ç¬¦ä¸²çš„å¼€å¤´å­—ç¬¦**ï¼Œå¦‚æœæ˜¯å°±æŠŠ0x0(\0)å­˜åˆ°rdxä¸­ï¼Œä¹Ÿå°±æ˜¯ç»“æŸäº†rdxä¸­å­—ç¬¦ä¸²çš„æ„é€ ï¼›å¦‚æœä¸æ˜¯å°±è·³è½¬åˆ°1727ï¼ŒæŠŠå½“å‰çš„å­—ç¬¦å¤åˆ¶åˆ°rdxä¸­å¹¶æŠŠraxæŒ‡é’ˆå‘å‰ç§»ã€‚

----

* **å­—ç¬¦ä¸²æ¯”è¾ƒ** 1745-1759

```
174b: lea    0x2a46(%rip),%rsi  ; rsi = ç›®æ ‡å­—ç¬¦ä¸²åœ°å€(0x4198)
1752: call   1d47 <strings_not_equal>
1757: test   %eax,%eax          ; æ£€æŸ¥æ˜¯å¦ç›¸ç­‰
1759: je     1778               ; å¦‚æœç›¸ç­‰ï¼Œè¿”å›1
```

è¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹ç›®æ ‡å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼š

![4](./imgs/image04.png)

éœ€è¦å’Œè¿™ä¸ªå­—ç¬¦ä¸²ç›¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬**è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬å**åº”è¯¥å’Œå…¶ç›¸åŒï¼Œé‚£ä¹ˆå°±åº”è¯¥æ˜¯ï¼š`DoUKnowThatGaiusJuliusCaesarOnceSaid...`ã€‚

æ€»ä¹‹ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ï¼šå°†phase2çš„ç¬¬ä¸ƒä¸ªå‚æ•°å­—ç¬¦ä¸²åè½¬ï¼Œä¸ç›®æ ‡å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œç›¸åŒæ‰å¯ä»¥ã€‚**æŠŠä¸Šè¿°å­—ç¬¦ä¸²åŠ åˆ°phase2çš„æœ«å°¾å³å¯**ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨è¾“å…¥ç¬¬ä¸€ä¸ªåˆ¤å®šçš„jumpä¹‹åå°±ä¼šå‡ºç°è¿™æ ·çš„è¯­å¥ï¼š

![5](./imgs/image05.png)

æˆ‘ä»¬æˆåŠŸè¿›å…¥äº†éšè—é˜¶æ®µï¼è¿™é‡Œéœ€è¦ç›´æ¥åœ¨å‘½ä»¤è¡Œè¾“å…¥ç­”æ¡ˆã€‚æˆ‘ä»¬ç»§ç»­çœ‹éšè—é˜¶æ®µçš„æ±‡ç¼–ã€‚

### ç ´è§£æ–¹å¼

#### FSMå‰ç½®çŸ¥è¯†

åœ¨è¿›å…¥è¿™ä¸€éƒ¨åˆ†ä¹‹å‰ï¼Œçœ‹åˆ°å‡½æ•°çš„åç§°å¯ä»¥å‘ç°æœ‰FSMçš„åç§°ã€‚é€šè¿‡æŸ¥è¯¢å¾—çŸ¥ï¼Œè¿™æ˜¯**finite-state machine**çš„ç¼©å†™ï¼Œå³æœ‰é™çŠ¶æ€æœºã€‚ä¸‹é¢å…ˆç»™å‡ºä¸€äº›åœ¨ç»è¿‡è¯¢é—®aiå’Œé˜…è¯»æœ‰å…³ä»‹ç»ä¹‹åçš„æœ¬äººç†è§£ï¼ˆå ç”²ï¼Œä¸ä¿è¯å®Œå…¨æ­£ç¡®ï¼Œä¸¥è°¨å®šä¹‰å’Œç†è§£è¯·å‚è€ƒå…¶ä»–èµ„æ–™ï¼ï¼ï¼‰ï¼š

å•¥æ˜¯æœ‰é™çŠ¶æ€æœºï¼Ÿæœç´¢è°·æ­Œå¾—çŸ¥å®šä¹‰ä¸ºï¼š

> æœ‰é™çŠ¶æ€æœºï¼ˆè‹±è¯­ï¼šfinite-state machineï¼Œç¼©å†™ï¼šFSMï¼‰åˆç§°æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼ˆè‹±è¯­ï¼šfinite-state automatonï¼Œç¼©å†™ï¼šFSAï¼‰ï¼Œç®€ç§°çŠ¶æ€æœºï¼Œæ˜¯è¡¨ç¤ºæœ‰é™ä¸ªçŠ¶æ€ä»¥åŠåœ¨è¿™äº›çŠ¶æ€ä¹‹é—´çš„è½¬ç§»å’ŒåŠ¨ä½œç­‰è¡Œä¸ºçš„æ•°å­¦è®¡ç®—æ¨¡å‹ã€‚

é‚£å°±å¯ä»¥ä»å…¶ç»„æˆéƒ¨åˆ†æ¥ç†è§£äº†ã€‚

* çŠ¶æ€ï¼ˆStatesï¼‰ï¼šç³»ç»Ÿå¯èƒ½å¤„äºçš„æœ‰é™ä¸ªçŠ¶å†µï¼Œå…¶ç‰¹ç‚¹æ˜¯ï¼šåœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ï¼ŒFSMåªèƒ½å¤„äºä¸€ä¸ªçŠ¶æ€ï¼Œä¸”æ€»çŠ¶æ€æ˜¯æœ‰é™çš„ã€‚æ¯”å¦‚ä¸€ä¸ªç”µæ¢¯æ§åˆ¶ç³»ç»Ÿï¼Œåœ¨ä»»æ„ä¸€åˆ»åªèƒ½å¤„äºé™æ­¢ã€ä¸Šè¡Œã€ä¸‹è¡Œã€å¼€é—¨ã€å…³é—¨è¿™äº”ä¸ªçŠ¶æ€ä¹‹ä¸€ã€‚
* è½¬ç§»ï¼ˆTransitionsï¼‰ï¼šçŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢è§„åˆ™ï¼Œå…¶è§¦å‘æ¡ä»¶é€šå¸¸ç”±è¾“å…¥äº‹ä»¶è§¦å‘ï¼Œæ¯”å¦‚ç”µæ¢¯åœ¨ç”¨æˆ·æŒ‰å…³é—¨æŒ‰é’®ä¹‹åï¼Œæœºå™¨æ¥æ”¶åˆ°è¿™ä¸€ä¸ªä¿¡å·ï¼Œè§¦å‘çŠ¶æ€çš„è½¬ç§»ï¼Œå³ä»å¼€é—¨çš„çŠ¶æ€è½¬ä¸ºå…³é—¨çš„çŠ¶æ€ã€‚
* è¾“å…¥å­—æ¯è¡¨ï¼ˆInput Alphabetï¼‰ï¼šæ‰€æœ‰å¯èƒ½è¾“å…¥å€¼çš„é›†åˆï¼Œæ¯”å¦‚ç”µæ¢¯ç³»ç»Ÿçš„æŒ‰é’®ã€‚
* åˆå§‹çŠ¶æ€ï¼ˆInitial Stateï¼‰ï¼šFSMå¼€å§‹è¿è¡Œæ—¶çš„èµ·å§‹çŠ¶æ€ã€‚
* æ¥å—çŠ¶æ€ï¼ˆAccept Statesï¼Œå¯é€‰ï¼‰ï¼šè¡¨ç¤º"æˆåŠŸ"æˆ–"å®Œæˆ"çš„çŠ¶æ€ã€‚

ä¸¾ä¸€ä¸ªğŸŒ°ï¼Œä¸‹é¢è¿™ä¸ªå›¾æ˜¯ä¸€ä¸ªFSMï¼Œå®ƒæœ‰ä¸‰ç§çŠ¶æ€å¯é€‰ï¼šA, B, Cï¼Œä¸”æ”¯æŒçš„è¾“å…¥å­—æ¯è¡¨ä»…ä»…æ˜¯0æˆ–è€…1ï¼Œç®­å¤´è¡¨ç¤ºå¯¹äºä¸€ä¸ªè¾“å…¥ï¼Œæœºå™¨ä»ä¸€ä¸ªçŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚

![ä¸€ä¸ªå‡è®¾çš„FSM](./imgs/image-1.png)

å‡è®¾å…¶åˆå§‹çŠ¶æ€æ˜¯Aï¼Œæˆ‘ä»¬å¯¹å…¶è¾“å…¥ä¸€ä¸ª0ï¼Œé‚£ä¹ˆå°±ä¼šæ²¿ç€å·¦ä¾§ä»AæŒ‡å‘Bçš„ç®­å¤´è¿›è¡Œè½¬ç§»ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çŠ¶æ€Bã€‚å‡è®¾æˆ‘ä»¬è¾“å…¥ä¸€ä¸²åºåˆ—ï¼š011001ï¼Œé‚£ä¹ˆå°±ä¼šç»è¿‡6æ¬¡è½¬ç§»ï¼ŒæŒ‰ç…§ç®­å¤´æ–¹å‘ï¼Œè¿‡ç¨‹æ˜¯ï¼š

$$
A \overset{0}{\rightarrow} B \overset{1}{\rightarrow} D \overset{1}{\rightarrow} D \overset{0}{\rightarrow} A \overset{0}{\rightarrow} B \overset{1}{\rightarrow} D
$$


æˆ‘ä»¬å¾—åˆ°æœ€ç»ˆçŠ¶æ€æ˜¯Dã€‚ï¼ˆå¯¹äºçŠ¶æ€Bå’ŒDï¼Œå¯¹äºè¾“å…¥åˆ†åˆ«ä¸º0å’Œ1æ—¶ï¼Œå…¶çŠ¶æ€è½¬ç§»åˆ°è‡ªèº«ä¹Ÿå°±æ˜¯ä¸å‘ç”Ÿæ”¹å˜ï¼‰

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼ˆ**åŒæ­¥åºåˆ—é—®é¢˜**ï¼‰ï¼š**å¯¹äºæœºå™¨çš„æ‰€æœ‰å¯èƒ½åˆå§‹çŠ¶æ€ï¼Œèƒ½ä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªç»™å®šæœ€å¤§é•¿åº¦çš„è¾“å…¥åºåˆ—**ï¼ˆå‡å®šè¿™ä¸ªFSMæ¥æ”¶çš„è¾“å…¥éƒ½æ˜¯0æˆ–è€…1ï¼‰ï¼Œ**ä½¿å¾—ç»è¿‡è¿™ä¸ªè¾“å…¥åºåˆ—è¿›è¡ŒçŠ¶æ€è½¬ç§»ä¹‹åï¼Œéƒ½å¾—åˆ°ä¸€ä¸ªç›¸åŒçš„æœ€ç»ˆçŠ¶æ€ï¼Ÿå¦‚æœå¯ä»¥ï¼Œå¦‚ä½•æ‰¾åˆ°ï¼Ÿ**

æ‹¿ä¸Šé¢é‚£ä¸ªä¾‹å­è¯´æ˜ã€‚æˆ‘ä»¬ç»™å‡ºä¸€ä¸ªè¾“å…¥åºåˆ—ï¼Œå¯¹äºæ‰€æœ‰å¯èƒ½çš„åˆå§‹çŠ¶æ€ï¼ˆå³Aã€Bã€Dï¼‰ï¼Œè®©å®ƒä»¬ç»è¿‡åŒæ ·çš„è¾“å…¥è¿›è¡Œè½¬ç§»åï¼Œå¾—åˆ°åŒæ ·çš„è½¬ç§»åçŠ¶æ€ã€‚ä¸éš¾çœ‹å‡ºï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæœ€çŸ­çš„åºåˆ—ï¼š1ã€‚å› ä¸ºä¸‰è€…ç»è¿‡è¾“å…¥1è½¬ç§»åéƒ½åˆ°è¾¾äº†Dï¼Œä¹Ÿå°±æ»¡è¶³äº†æ¡ä»¶ã€‚

æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•ç³»ç»Ÿæ€§åœ°æ±‚è§£å‡ºæ¥è¿™ä¸ªåºåˆ—å‘¢ï¼Ÿè€ƒè™‘åˆ°ä¸Šå›¾ä¸­èŠ‚ç‚¹å’Œè¾¹çš„ç»“æ„ï¼Œå¯ä»¥å‘ç°è¿™å…¶å®æ˜¯ä¸€ä¸ªå›¾ï¼Œæ¯ä¸ªçŠ¶æ€æ„æˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¾“å…¥çš„å­—ç¬¦æ„æˆä¸€æ¡å•å‘è¾¹ã€‚é‚£æˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸Šè¿°é¢˜ç›®å¦‚ä¸‹ï¼š**å¯¹äºä¸€ä¸ªæœ‰é™èŠ‚ç‚¹çš„å›¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å›ºå®šä¸ªæ•°çš„å‡ºåº¦**ï¼ˆè¿™é‡Œè®¾å®šä¸º2ï¼Œå³0å’Œ1ï¼‰**ä¸”å¯èƒ½å½¢æˆè‡ªç¯ï¼Œèƒ½å¦æ‰¾åˆ°ä¸€ä¸ªç»™å®šæœ€å¤§é•¿åº¦çš„è¾“å…¥åºåˆ—**ï¼ˆå‡å®šè¾“å…¥åºåˆ—ç”±0å’Œ1æ„æˆï¼‰ï¼Œ**ä½¿å¾—å›¾ä¸­ä»¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºå‡ºå‘ç‚¹ç»è¿‡è¿™ä¸ªè¾“å…¥åºåˆ—çš„ç§»åŠ¨ä¹‹åï¼Œéƒ½åˆ°è¾¾åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Ÿå¦‚æœå¯ä»¥ï¼Œå¦‚ä½•æ‰¾åˆ°ï¼Ÿ**

æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°†ä¸Šè¿°å›¾ä¸­çš„åˆå§‹çŠ¶æ€ç¼–ç ä¸º0ï¼Œ1ï¼Œ2ï¼Œåˆ†åˆ«å¯¹åº”çŠ¶æ€Aï¼ŒBï¼ŒDã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªçŠ¶æ€è½¬ç§»è¡¨ï¼š

| state | input=0 | input=1 |
|---|---|---|
| 0 | 1 | 2 |
| 1 | 1 | 2 |
| 2 | 0 | 2 |

å…¶ä¸­ç¬¬äºŒåˆ—çš„æ•°å­—è¡¨ç¤ºï¼Œå¯¹äºè¯¥æ•°å­—æ‰€åœ¨è¡Œçš„åˆå§‹çŠ¶æ€ï¼ŒæŒ‰ç…§è¯¥åˆ—çš„è¾“å…¥å€¼è¿›è¡Œè½¬ç§»åï¼Œæ‰€å¾—åˆ°çš„æ–°çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œå¯¹äºåˆçŠ¶æ€1ï¼Œè¾“å…¥1ï¼Œå¾—åˆ°2ï¼Œå¯¹åº”ä¸Šå›¾ä¸­Bè¾“å…¥1å¾—åˆ°Dã€‚

**è€ƒè™‘å°†åˆå§‹çŠ¶æ€çœ‹æˆä¸€ä¸ªé›†åˆ**ï¼š{0ï¼Œ1ï¼Œ2}ï¼Œæ¯æ¬¡è¾“å…¥ä¸€ä¸ªå­—ç¬¦0æˆ–1ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ è¿›è¡ŒåŒæ­¥åœ°è½¬ç§»æ›´æ–°æ¥å¾—åˆ°ä¸€ä¸ªæ–°çš„é›†åˆã€‚ä¾‹å¦‚ï¼Œè¾“å…¥1ï¼Œé€šè¿‡æŸ¥è¡¨å¾—åˆ°æ›´æ–°åçš„çŠ¶æ€é›†åˆä¸ºï¼š{2}ã€‚æˆ‘ä»¬å‘ç°ï¼Œæ­¤æ—¶é›†åˆé•¿åº¦ä¸º1ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä½¿å¾—æ‰€æœ‰çŠ¶æ€éƒ½åˆ°è¾¾äº†åŒä¸€ä¸ªç»ˆçŠ¶æ€ï¼ä¹Ÿå°±æ˜¯å¾—åˆ°äº†ç­”æ¡ˆã€‚

![å°†çŠ¶æ€çœ‹æˆé›†åˆï¼Œæ¯æ¬¡è¾“å…¥éƒ½æ˜¯å¯¹é›†åˆå…ƒç´ çš„åŒæ­¥æ“ä½œï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœæ˜¯é›†åˆåªæœ‰ä¸€ç§å…ƒç´ ](./imgs/image-2.png)

> å°†çŠ¶æ€çœ‹æˆé›†åˆï¼Œæ¯æ¬¡è¾“å…¥éƒ½æ˜¯å¯¹é›†åˆå…ƒç´ çš„åŒæ­¥æ“ä½œï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœæ˜¯é›†åˆåªæœ‰ä¸€ç§å…ƒç´ 

æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•æ¥æ‰¾åˆ°å‘¢ï¼Ÿ**æ¯æ¬¡è¾“å…¥æ˜¯å›ºå®šçš„0æˆ–è€…1ï¼Œæ—¢ç„¶æœ‰ä¸€ä¸ªç»™å®šçš„æœ€å¤§é•¿åº¦ï¼Œé‚£ä¸å¦¨ç›´æ¥ä»çŸ­åˆ°é•¿å¯¹æ‰€æœ‰å¯èƒ½çš„åºåˆ—éƒ½è¿›è¡Œä¸€æ¬¡æœç´¢ã€‚è¿™ä¸å°±æ˜¯BFSå—**ï¼Ÿï¼æˆ‘ä»¬å°†çŠ¶æ€é›†åˆå…¥é˜Ÿåˆ—ï¼Œä¿å­˜ä¸€ä¸ªçŠ¶æ€è½¬ç§»pathï¼Œæ¯æ¬¡å¼¹å‡ºä¸€ä¸ªé›†åˆéƒ½å¯¹0æˆ–1è¿›è¡Œè½¬ç§»è¯•æ¢ï¼Œå¦‚æœè¿™ä¸ªçŠ¶æ€ä¹‹å‰æ²¡å‡ºç°è¿‡å°±å…¥é˜Ÿï¼Œå¹¶æŠŠ0æˆ–1åŠ å…¥åˆ°pathç»ˆï¼Œå¦åˆ™è·³è¿‡ï¼›å¦‚æœpathé•¿åº¦è¶…è¿‡æœ€å¤§é•¿åº¦è¯´æ˜ä¸èƒ½æ‰¾åˆ°ã€‚æˆ‘ä»¬ç»™å‡ºä¸‹é¢çš„pythonä»£ç ï¼š


```python

from collections import deque

transition_table = [
    [1, 2],  # çŠ¶æ€A: è¾“å…¥0â†’B(1), è¾“å…¥1â†’D(2)
    [1, 2],  # çŠ¶æ€B: è¾“å…¥0â†’B(1), è¾“å…¥1â†’D(2)
    [0, 2],  # çŠ¶æ€D: è¾“å…¥0â†’A(0), è¾“å…¥1â†’D(2)
]

MAX_length = 10

init_states = frozenset(range(3))

q = deque([(init_states, '')])
visited = set(init_states)
length = 0
while q:
    curr_states, path = q.popleft()
    if length > MAX_length:
        print("Impossible!")
        break
    if len(curr_states) == 1: # ä¸‰ç§çŠ¶æ€éƒ½è½¬ç§»åˆ°äº†åŒä¸€ç§çŠ¶æ€
        print(path)
        break
    for input_num in [0, 1]:
        next_states = frozenset(transition_table[state][input_num] for state in curr_states)
        if next_states not in visited:
            q.append((next_states, path + str(input_num)))
            visited.add(next_states)
```

æˆ‘ä»¬å¾—åˆ°å’Œä¸Šé¢è‚‰çœ¼è§‚å¯Ÿç›¸åŒçš„ç­”æ¡ˆï¼š1ã€‚è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“å¦‚ä½•è§£ç­”ä¸Šè¿°çš„åŒæ­¥åºåˆ—é—®é¢˜äº†ï¼

#### è§£è¯»éšè—é˜¶æ®µ

![6](./imgs/image.png)

ä¸‹é¢æ˜¯è¿™ä¸ªé˜¶æ®µçš„æ±‡ç¼–ä»£ç ï¼Œä»¥åŠé¢å¤–çš„ä¸¤ä¸ªè¾…åŠ©å‡½æ•°çš„æ±‡ç¼–ã€‚åœ¨æ±‡ç¼–ä¸­éƒ½åŠ æœ‰æ³¨é‡Šã€‚


```assembly
0000000000001b60 <emulate_fsm>:  -- çŠ¶æ€è½¬ç§»å‡½æ•°
    1b60:	f3 0f 1e fa          	endbr64
    1b64:	55                   	push   %rbp
    1b65:	53                   	push   %rbx
    1b66:	48 83 ec 08          	sub    $0x8,%rsp
    1b6a:	89 fd                	mov    %edi,%ebp  -- ebp = åˆå§‹çŠ¶æ€
    1b6c:	48 89 f3             	mov    %rsi,%rbx  -- rbx = è¾“å…¥å­—ç¬¦ä¸²
    1b6f:	eb 28                	jmp    1b99 <emulate_fsm+0x39> -- è¿›å…¥ä¸»å¾ªç¯1b99

    -- çŠ¶æ€è½¬ç§»è®¡ç®—ï¼Œå°†éå†çš„åˆå§‹çŠ¶æ€(0-6)æŒ‰ç…§è½¬ç§»è¡¨ï¼Œå¯¹åº”è¾“å…¥çš„0æˆ–è€…1å¾—åˆ°å¯¹åº”çš„æ–°çŠ¶æ€
    1b71:	0f be 03             	movsbl (%rbx),%eax  -- è¯»å–è¾“å…¥å­—ç¬¦
    1b74:	83 e8 30             	sub    $0x30,%eax  -- å­—ç¬¦-'0'å¾—åˆ°0æˆ–1
    1b77:	48 63 ed             	movslq %ebp,%rbp  -- rbp = åˆå§‹çŠ¶æ€
    1b7a:	48 98                	cltq
    1b7c:	48 8d 14 c5 00 00 00 	lea    0x0(,%rax,8),%rdx  -- rdx = è¾“å…¥å€¼ * 8
    1b83:	00 
    1b84:	48 29 c2             	sub    %rax,%rdx  -- rdx = è¾“å…¥å€¼ * 7
    1b87:	48 8d 04 2a          	lea    (%rdx,%rbp,1),%rax  -- rax = åˆå§‹çŠ¶æ€ + è¾“å…¥å€¼ * 7
    1b8b:	48 8d 15 6e 27 00 00 	lea    0x276e(%rip),%rdx        # 4300 <transition_table> 
    -- è·å–è½¬ç§»è¡¨çš„åœ°å€ï¼ˆè§ä¸‹æ–¹æ–‡å­—å™è¿°çš„è½¬ç§»è¡¨ï¼‰
    1b92:	8b 2c 82             	mov    (%rdx,%rax,4),%ebp  -- ebp = æ–°çŠ¶æ€ = table[ç´¢å¼•]
    1b95:	48 83 c3 01          	add    $0x1,%rbx  -- rbx++ï¼Œç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦

    -- ä¸»å¾ªç¯
    1b99:	0f b6 03             	movzbl (%rbx),%eax  -- è¯»å–å½“å‰å­—ç¬¦
    1b9c:	84 c0                	test   %al,%al  -- æ£€æµ‹æ˜¯å¦ä¸ºNULL
    1b9e:	74 0e                	je     1bae <emulate_fsm+0x4e>  -- å¦‚æœæ˜¯NULLåˆ™æ— éœ€è½¬ç§»ï¼Œè¿”å›è¾“å…¥çš„åˆå§‹çŠ¶æ€
    1ba0:	83 e8 30             	sub    $0x30,%eax  -- å­—ç¬¦-'0'ï¼ˆå¾—åˆ°æ•°å­—ï¼‰
    1ba3:	3c 01                	cmp    $0x1,%al  -- æ£€æµ‹æ˜¯å¦å°äºç­‰äº1ï¼ˆæ˜¯å¦æ˜¯0æˆ–1ï¼‰
    1ba5:	76 ca                	jbe    1b71 <emulate_fsm+0x11>  -- å¦‚æœæ˜¯0æˆ–1å°±è®¡ç®—è¯¥æ•°å­—å¯¹åº”çš„è½¬ç§»ç»“æœ
    1ba7:	e8 b0 04 00 00       	call   205c <explode_bomb>  -- å¦‚æœä¸æ˜¯å°±çˆ†ç‚¸
    1bac:	eb c3                	jmp    1b71 <emulate_fsm+0x11>

    1bae:	89 e8                	mov    %ebp,%eax  -- å¦‚æœæ˜¯NULLåˆ™æ— éœ€è½¬ç§»ï¼Œè¿”å›è¾“å…¥çš„åˆå§‹çŠ¶æ€
    1bb0:	48 83 c4 08          	add    $0x8,%rsp
    1bb4:	5b                   	pop    %rbx
    1bb5:	5d                   	pop    %rbp
    1bb6:	c3                   	ret

0000000000001bb7 <check_synchronizing_sequence>:  -- æ£€æµ‹åºåˆ—æ˜¯å¦å®Œå…¨åŒæ­¥ï¼ˆç›¸åŒï¼‰å‡½æ•°
    1bb7:	f3 0f 1e fa          	endbr64
    1bbb:	41 54                	push   %r12
    1bbd:	55                   	push   %rbp
    1bbe:	53                   	push   %rbx
    1bbf:	48 89 fd             	mov    %rdi,%rbp  -- rbp = è¾“å…¥å­—ç¬¦ä¸²

    -- ä»åˆå§‹çŠ¶æ€ä¸º0å¼€å§‹æ¨¡æ‹ŸFSMï¼ŒæŠŠ0çš„ç»ˆçŠ¶æ€ä½œä¸ºå‚è€ƒä¸åç»­åšæ¯”è¾ƒ
    1bc2:	48 89 fe             	mov    %rdi,%rsi  -- rsi = è¾“å…¥å­—ç¬¦ä¸²
    1bc5:	bf 00 00 00 00       	mov    $0x0,%edi  -- edi = åˆå§‹çŠ¶æ€0
    1bca:	e8 91 ff ff ff       	call   1b60 <emulate_fsm>  -- è°ƒç”¨è½¬ç§»å‡½æ•°å¾—åˆ°ç»ˆçŠ¶æ€
    1bcf:	41 89 c4             	mov    %eax,%r12d -- r12d = å‚è€ƒæœ€ç»ˆçŠ¶æ€

    -- å¾ªç¯æ£€æŸ¥åˆå§‹çŠ¶æ€1-6
    1bd2:	bb 01 00 00 00       	mov    $0x1,%ebx  -- ebx = åˆå§‹çŠ¶æ€(1)
    1bd7:	83 fb 06             	cmp    $0x6,%ebx  -- å¼€å§‹éå†1åˆ°6
    1bda:	7f 14                	jg     1bf0 <check_synchronizing_sequence+0x39>
    1bdc:	48 89 ee             	mov    %rbp,%rsi  -- rsi = è¾“å…¥å­—ç¬¦ä¸²
    1bdf:	89 df                	mov    %ebx,%edi  -- edi = åˆå§‹çŠ¶æ€
    1be1:	e8 7a ff ff ff       	call   1b60 <emulate_fsm> -- å¾—åˆ°è¯¥åˆå§‹çŠ¶æ€è½¬ç§»åçš„ç»ˆçŠ¶æ€
    1be6:	44 39 e0             	cmp    %r12d,%eax -- æ¯”è¾ƒæœ€ç»ˆçŠ¶æ€ä¸å‚è€ƒåŸºå‡†æ˜¯å¦ç›¸åŒ
    1be9:	75 0f                	jne    1bfa <check_synchronizing_sequence+0x43> -- å¦‚æœä¸åŒå°±è·³åˆ°1bfa
    1beb:	83 c3 01             	add    $0x1,%ebx  -- å¦‚æœç›¸åŒï¼Œebx++ï¼Œéå†ä¸‹ä¸€ä¸ªåˆå§‹çŠ¶æ€
    1bee:	eb e7                	jmp    1bd7 <check_synchronizing_sequence+0x20>

    1bf0:	b8 00 00 00 00       	mov    $0x0,%eax -- å¦‚æœ1-6çš„åˆå§‹çŠ¶æ€éƒ½ä¸0ç›¸åŒå°±eaxè®¾ç½®ä¸º0è¿”å›ï¼Œä¸ä¼šçˆ†
    1bf5:	5b                   	pop    %rbx
    1bf6:	5d                   	pop    %rbp
    1bf7:	41 5c                	pop    %r12
    1bf9:	c3                   	ret
    1bfa:	b8 ff ff ff ff       	mov    $0xffffffff,%eax  -- å¦‚æœä¸åŒå°±æŠŠeaxè®¾ç½®ä¸ºå…¨1ï¼Œè¿™æ ·åœ¨secretå‡½æ•°ä¸­test eaxå¾—åˆ°1ï¼Œä½¿å¾—çˆ†ç‚¸
    1bff:	eb f4                	jmp    1bf5 <check_synchronizing_sequence+0x3e>

0000000000001c01 <secret_phase>:
    1c01:	f3 0f 1e fa          	endbr64
    1c05:	55                   	push   %rbp
    1c06:	53                   	push   %rbx
    1c07:	48 83 ec 18          	sub    $0x18,%rsp
    1c0b:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax
    1c12:	00 00 
    1c14:	48 89 44 24 08       	mov    %rax,0x8(%rsp)
    1c19:	31 c0                	xor    %eax,%eax

    -- è¯»å–è¾“å…¥
    1c1b:	e8 07 05 00 00       	call   2127 <read_line>
    1c20:	48 89 c5             	mov    %rax,%rbp   -- rbp = è¾“å…¥å­—ç¬¦ä¸²

    -- æ£€æŸ¥è¾“å…¥é•¿åº¦<=17
    1c23:	bb 00 00 00 00       	mov    $0x0,%ebx   -- è®¡æ•°å™¨ebx=0
    1c28:	eb 03                	jmp    1c2d <secret_phase+0x2c>  -- è¿›å…¥å­—ç¬¦éå†
    1c2a:	83 c3 01             	add    $0x1,%ebx   -- è®¡æ•°å™¨++

    1c2d:	48 63 c3             	movslq %ebx,%rax
    1c30:	80 7c 05 00 00       	cmpb   $0x0,0x0(%rbp,%rax,1)  -- æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºNULL
    1c35:	74 0c                	je     1c43 <secret_phase+0x42>  -- å¦‚æœæ˜¯NULLè·³å‡ºéå†ç»“æŸæ£€æŸ¥
    1c37:	83 fb 10             	cmp    $0x10,%ebx  -- æ¯”è¾ƒé•¿åº¦æ˜¯å¦<=17
    1c3a:	7e ee                	jle    1c2a <secret_phase+0x29>  -- å¦‚æœæ˜¯å°±ç»§ç»­æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯NULL
    1c3c:	e8 1b 04 00 00       	call   205c <explode_bomb>  -- å¦‚æœä¸æ˜¯å°±çˆ†ç‚¸
    1c41:	eb e7                	jmp    1c2a <secret_phase+0x29>

    -- æ£€æŸ¥åŒæ­¥åºåˆ— check_synchronizing_sequence
    1c43:	48 89 ef             	mov    %rbp,%rdi  -- rdi = è¾“å…¥å­—ç¬¦ä¸²
    1c46:	e8 6c ff ff ff       	call   1bb7 <check_synchronizing_sequence>
    1c4b:	85 c0                	test   %eax,%eax
    1c4d:	75 45                	jne    1c94 <secret_phase+0x93>  -- å¦‚æœæ£€æŸ¥åŒæ­¥å¤±è´¥å°±çˆ†ç‚¸ï¼Œä¸‹é¢çš„è¾“å‡ºæˆåŠŸä¿¡æ¯å¹¶è¿”å›
    1c4f:	48 8d 3d aa 25 00 00 	lea    0x25aa(%rip),%rdi        # 4200 <_IO_stdin_used+0x200>
    1c56:	e8 15 f6 ff ff       	call   1270 <puts@plt>
    1c5b:	48 8d 3d ce 25 00 00 	lea    0x25ce(%rip),%rdi        # 4230 <_IO_stdin_used+0x230>
    1c62:	e8 09 f6 ff ff       	call   1270 <puts@plt>
    1c67:	48 8d 3d 1a 26 00 00 	lea    0x261a(%rip),%rdi        # 4288 <_IO_stdin_used+0x288>
    1c6e:	e8 fd f5 ff ff       	call   1270 <puts@plt>
    1c73:	48 8d 7c 24 04       	lea    0x4(%rsp),%rdi
    1c78:	e8 e8 05 00 00       	call   2265 <phase_defused>
    1c7d:	48 8b 44 24 08       	mov    0x8(%rsp),%rax
    1c82:	64 48 2b 04 25 28 00 	sub    %fs:0x28,%rax
    1c89:	00 00 
    1c8b:	75 0e                	jne    1c9b <secret_phase+0x9a>
    1c8d:	48 83 c4 18          	add    $0x18,%rsp
    1c91:	5b                   	pop    %rbx
    1c92:	5d                   	pop    %rbp
    1c93:	c3                   	ret
    1c94:	e8 c3 03 00 00       	call   205c <explode_bomb>
    1c99:	eb b4                	jmp    1c4f <secret_phase+0x4e>
    1c9b:	e8 00 f6 ff ff       	call   12a0 <__stack_chk_fail@plt>
```

----

æ±‡ç¼–ä»£ç çš„è¯¦ç»†è§£é‡Šåœ¨ä¸Šè¿°åŒçŸ­æ¨ªçº¿çš„æ³¨é‡Šä¸­ï¼Œä¸‹é¢ç”¨deepseekç»™å‡ºä¸€ä¸ªcè¯­è¨€ç‰ˆæœ¬æ–¹ä¾¿ç†è§£ï¼š

```c
// Generated by Deepseek

int emulate_fsm(int initial_state, const char* input) {
    int current_state = initial_state;
    const char* ptr = input;
    
    while (*ptr != '\0') {
        // éªŒè¯è¾“å…¥åªèƒ½æ˜¯'0'æˆ–'1'
        int input_val = *ptr - '0';
        if (input_val != 0 && input_val != 1) {
            explode_bomb();
        }
        
        // è®¡ç®—çŠ¶æ€è½¬ç§»ç´¢å¼•: index = current_state + input_val * 7
        int index = current_state + input_val * 7;
        
        // ä»è½¬ç§»è¡¨ä¸­è·å–æ–°çŠ¶æ€
        current_state = transition_table[index];
        
        ptr++;  // ä¸‹ä¸€ä¸ªå­—ç¬¦
    }
    
    return current_state;
}

int check_synchronizing_sequence(const char* input) {
    // ä»ä½ç½®0å¼€å§‹æ¨¡æ‹Ÿï¼Œå¾—åˆ°å‚è€ƒæœ€ç»ˆçŠ¶æ€
    int reference_state = emulate_fsm(0, input);
    
    // æ£€æŸ¥ä»ä½ç½®1-6å¼€å§‹æ¨¡æ‹Ÿæ˜¯å¦éƒ½åˆ°è¾¾ç›¸åŒçŠ¶æ€
    for (int start_pos = 1; start_pos <= 6; start_pos++) {
        int final_state = emulate_fsm(start_pos, input + start_pos);
        if (final_state != reference_state) {
            return -1;  // å¤±è´¥
        }
    }
    
    return 0;  // æˆåŠŸ
}

void secret_phase() {
    char* input = read_line();
    
    // æ£€æŸ¥è¾“å…¥é•¿åº¦ â‰¤ 16
    int length = 0;
    for (int i = 0; ; i++) {
        if (input[i] == '\0') {
            break;
        }
        if (i > 16) {
            explode_bomb();  // é•¿åº¦è¶…è¿‡16ï¼Œçˆ†ç‚¸
        }
    }
    
    // æ£€æŸ¥æ˜¯å¦ä¸ºåŒæ­¥åºåˆ—
    int result = check_synchronizing_sequence(input);
    if (result != 0) {
        explode_bomb();  // ä¸æ˜¯åŒæ­¥åºåˆ—ï¼Œçˆ†ç‚¸
    }
    
    // æˆåŠŸè¾“å‡º
    // puts("æ­å–œï¼ä½ æ‰¾åˆ°äº†åŒæ­¥åºåˆ—ï¼");
    // puts("è¿™ä¸ªåºåˆ—æ— è®ºä»å“ªä¸ªä½ç½®å¼€å§‹ï¼Œéƒ½èƒ½è®©FSMåˆ°è¾¾ç›¸åŒçŠ¶æ€ã€‚");
    // puts("éšè—é˜¶æ®µé€šè¿‡ï¼");
    
    phase_defused();
}

```

* é¦–å…ˆï¼Œè¿™æ˜¯ä¸€ä¸ª**FSMçŠ¶æ€è‡ªåŠ¨æœº**ï¼›
* å…¶æ¬¡ï¼ŒçŠ¶æ€è½¬ç§»è¡¨éœ€è¦åœ¨gdbä¸­è‡ªè¡Œæ‰¾åˆ°ï¼Œå¹¶ä¸”æŒ‰ç…§æ­£ç¡®çš„é¡ºåºå¡«è¡¨ï¼›
* æœ€åï¼Œé¢˜ç›®è¦æ±‚å¯¹äºä»0åˆ°6çš„ä¸ƒç§åˆå§‹çŠ¶æ€ï¼Œåº”è¾“å…¥ä¸€ä¸ª01å­—ç¬¦ä¸²ï¼Œä½¿å¾—ç»è¿‡è¿™ä¸ªå­—ç¬¦ä¸²åºåˆ—è¿›è¡ŒçŠ¶æ€è½¬æ¢åï¼Œå¾—åˆ°çš„ä¸ƒç§æ–°çŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚

---

ä»gdbæŸ¥çœ‹çŠ¶æ€è½¬ç§»è¡¨çš„å…·ä½“å†…å®¹ï¼š

```
(gdb) info address transition_table 
Symbol "transition_table" is at 0x555555558300 in a file compiled without debugging. 

(gdb) x/64xb 0x555555558300 

0x555555558300 <transition_table>: 0x03 0x00 0x00 0x00 0x06 0x00 0x00 0x00 
0x555555558308 <transition_table+8>: 0x00 0x00 0x00 0x00 0x05 0x00 0x00 0x00 
0x555555558310 <transition_table+16>: 0x04 0x00 0x00 0x00 0x01 0x00 0x00 0x00 
0x555555558318 <transition_table+24>: 0x02 0x00 0x00 0x00 0x00 0x00 0x00 0x00 
0x555555558320 <transition_table+32>: 0x04 0x00 0x00 0x00 0x02 0x00 0x00 0x00 
0x555555558328 <transition_table+40>: 0x03 0x00 0x00 0x00 0x05 0x00 0x00 0x00 
0x555555558330 <transition_table+48>: 0x04 0x00 0x00 0x00 0x06 0x00 0x00 0x00
```

å¯¹åº”çš„çŠ¶æ€è¡¨ï¼š

|state|input 0|input 1|
|---|---|---|
|0|3|0|
|1|6|4|
|2|0|2|
|3|5|3|
|4|4|5|
|5|1|4|
|6|2|6|

ç»™å‡ºä¸€ä¸ªå›¾ç¤ºï¼š

![alt text](./imgs/image3.png)

è¿™é‡Œè¡¨æ˜¯ **æŒ‰ç…§åˆ—å¡«å……** çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› åœ¨`emulate_fsm`ä¸­æœ‰è¿™æ ·ä¸€æ®µçŠ¶æ€è½¬ç§»çš„é€»è¾‘ï¼š

```
; çŠ¶æ€è½¬ç§»è®¡ç®—
1b71: movsbl (%rbx),%eax        ; è¯»å–å­—ç¬¦
1b74: sub    $0x30,%eax         ; eax = è¾“å…¥å€¼(0æˆ–1)
1b77: movslq %ebp,%rbp          ; æ‰©å±•å½“å‰çŠ¶æ€
1b7a: cltq                      ; æ‰©å±•è¾“å…¥å€¼
1b7c: lea    0x0(,%rax,8),%rdx  ; rdx = è¾“å…¥å€¼ * 8
1b84: sub    %rax,%rdx          ; rdx = è¾“å…¥å€¼ * 7
1b87: lea    (%rdx,%rbp,1),%rax ; rax = å½“å‰çŠ¶æ€ + è¾“å…¥å€¼*7
1b8b: lea    0x276e(%rip),%rdx  ; rdx = transition_tableåœ°å€
1b92: mov    (%rdx,%rax,4),%ebp ; æ–°çŠ¶æ€ = table[ç´¢å¼•]
1b95: add    $0x1,%rbx          ; ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦
1b99: jmp    ä¸»å¾ªç¯å¼€å§‹
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€çš„å€¼æ˜¯è¿™æ ·è®¡ç®—çš„ï¼š

$$ state_{new} = table[4_{bytes} \cdot (state_{old} + 7 \cdot input_{{0,1}})] $$

æ¯”å¦‚ï¼Œå½“å‰çŠ¶æ€æ˜¯0ï¼Œè¾“å…¥0å¾—åˆ°çš„æ–°çŠ¶æ€ä»ç„¶æ˜¯0ï¼›è¾“å…¥1ï¼Œå¾—åˆ°çš„çŠ¶æ€åº”è¯¥æ˜¯table[4*7]ï¼Œè·¨è¶Š7ä¸ª4å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯è·¨è¶Šäº†ä¸€åˆ—ï¼Œåˆ°è¾¾ç¬¬äºŒåˆ—0å¯¹åº”çš„è¾“å…¥ä¸º1çš„æ–°çŠ¶æ€0ã€‚

---

é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ‰¾åˆ°ä¸€ä¸ªé•¿åº¦ä¸è¶…è¿‡17çš„01åºåˆ—ï¼Œä½¿å¾—å¯¹äº0-6è¿™ä¸ƒç§åˆå§‹çŠ¶æ€ï¼Œéƒ½èƒ½å¾—åˆ°ä¸€ä¸ªç›¸åŒçš„ç»ˆçŠ¶æ€å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªç®—æ³•é¢˜ï¼Œè€ƒè™‘ç”¨**BFS**æ¥è§£å†³ï¼Œç›¸å½“äºå¯¹æ¯æ¬¡çš„0å’Œ1è¾“å…¥è¿›è¡Œéå†ï¼Œä¸€æ—¦å‘ç°ä¸ƒç§çŠ¶æ€éƒ½ç›¸åŒäº†å°±è¿”å›è·¯å¾„ã€‚ä¸‹é¢æ˜¯pythonä»£ç ï¼š

```python
from collections import deque

transition_table = [
    [3, 0],  # state 0: input0->3, input1->0
    [6, 4],  # state 1: input0->6, input1->4
    [0, 2],  # state 2: input0->0, input1->2
    [5, 3],  # state 3: input0->5, input1->3
    [4, 5],  # state 4: input0->4, input1->5
    [1, 4],  # state 5: input0->1, input1->4
    [2, 6],  # state 6: input0->2, input1->6
]

init_states = frozenset(range(7))

q = deque([(init_states, '')])
visited = set(init_states)
length = 0
while q:
    curr_states, path = q.popleft()
    if length > 17:
        print("Impossible!")
        break
    if len(curr_states) == 1: # ä¸ƒç§çŠ¶æ€éƒ½è½¬ç§»åˆ°äº†åŒä¸€ç§çŠ¶æ€
        print(path)
        break
    for input_num in [0, 1]:
        next_states = frozenset(transition_table[state][input_num] for state in curr_states)
        if next_states not in visited:
            q.append((next_states, path + str(input_num)))
            visited.add(next_states)
```

è¿™æ®µä»£ç ä¸­ä½¿ç”¨äº†frozensetï¼ŒåŸå› æ˜¯æˆ‘ä»¬æƒ³æŠŠè¿™7ä¸ªå€¼çš„çŠ¶æ€ä¿å­˜åˆ°visitedè¿™ä¸ªsetä¸­ï¼Œsetä¸­å­˜setæ˜¯ä¸è¡Œçš„ï¼Œä½†æ˜¯å­˜frozensetæ˜¯å¯ä»¥çš„ã€‚è¿è¡Œç»“æœæ˜¯10101010100000101ã€‚è¿™å°±æ˜¯éšè—é˜¶æ®µçš„ç­”æ¡ˆäº†ï¼å¤§åŠŸå‘Šæˆï¼

ï¼ˆåè®°ï¼šå°†ç­”æ¡ˆå†™åˆ°answer.txtçš„ç¬¬ä¸ƒè¡Œï¼Œå¹¶æŠŠå…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™bombï¼Œå¯ä»¥ä¸ç”¨æ‰§è¡Œæ£€æµ‹ä¸€ä¸­çš„jumpï¼Œå°±èƒ½å¤Ÿå®Œæˆéšè—é˜¶æ®µï¼‰